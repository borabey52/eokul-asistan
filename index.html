<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>e-Okul AdÄ±m AdÄ±m Asistan</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #2c3e50; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: white; }
        .card { background: white; color:#333; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); max-width: 500px; text-align: center; }
        .bookmark-btn {
            display: inline-block;
            background: #2980b9; /* Mavi: AdÄ±m AdÄ±m Mod */
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 18px;
            border: 2px dashed #3498db;
            cursor: grab;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.4);
            transition: transform 0.2s;
        }
        .bookmark-btn:hover { transform: scale(1.05); }
    </style>
</head>
<body>

    <div class="card">
        <h1>ğŸ‘£ AdÄ±m AdÄ±m Asistan</h1>
        <p>Otomatik dÃ¶ngÃ¼ yok. Siz "Onayla" diyene kadar beklemede kalÄ±r.</p>

        <a class="bookmark-btn" href="javascript:(function(){
            var kumanda=window.open('','GeminiAdimAdim','width=360,height=650,top=50,left=50');
            if(!kumanda){alert('LÃ¼tfen POP-UP izni verin!');return}

            var html=`
            <html><head><style>
                body{font-family:'Segoe UI',sans-serif;padding:15px;background:#f0f2f5;color:#333}
                textarea{width:100%;height:80px;font-size:11px;border:1px solid #ccc;border-radius:5px;padding:5px}
                button{width:100%;padding:12px;margin:5px 0;cursor:pointer;font-weight:bold;color:white;border:none;border-radius:6px;font-size:14px;transition:0.2s}
                button:active{transform:scale(0.98)}
                .btn-load{background:#34495e} 
                .btn-next{background:#27ae60;height:60px;font-size:16px;box-shadow:0 4px 0 #219150}
                .btn-skip{background:#f39c12}
                #info{background:white;padding:10px;border-radius:5px;margin:10px 0;border-left:5px solid #2980b9;font-size:13px}
                .badge{display:inline-block;padding:3px 6px;border-radius:4px;color:white;font-size:10px;font-weight:bold}
                .b-iyi{background:#27ae60} .b-orta{background:#3498db} .b-zayif{background:#e74c3c}
            </style></head><body>
                <h3 style='margin-top:0;text-align:center'>ğŸ‘£ AdÄ±m AdÄ±m Kontrol</h3>
                
                <div id='setupArea'>
                    <textarea id='data' placeholder='Excelden YapÄ±ÅŸtÄ±r:\nAd Soyad   Durum'></textarea>
                    <button onclick='listeyiYukle()' class='btn-load'>ğŸ“¥ Listeyi YÃ¼kle ve BaÅŸla</button>
                </div>

                <div id='runArea' style='display:none'>
                    <div id='info'>SÄ±radaki Bekleniyor...</div>
                    
                    <button onclick='siradakiIslem()' class='btn-next' id='btnNext'>
                        â–¶ï¸ UYGULA VE KAYDET
                    </button>
                    
                    <button onclick='atla()' class='btn-skip'>â­ï¸ Bu Ã–ÄŸrenciyi Atla</button>
                    
                    <div style='margin-top:15px;font-size:11px;color:#7f8c8d;text-align:center'>
                        Ã–ÄŸrenci SayacÄ±: <span id='counter'>0</span> / <span id='total'>0</span>
                    </div>
                </div>

            </body>
            <script>
                var liste = [];
                var sira = 0;
                var anaPencere = window.opener;

                function guncelleInfo(){
                    if(sira >= liste.length){
                        document.getElementById('info').innerHTML = '<b>ğŸ‰ LÄ°STE TAMAMLANDI!</b>';
                        document.getElementById('btnNext').disabled = true;
                        document.getElementById('btnNext').style.background = '#ccc';
                        document.getElementById('btnNext').innerText = 'Bitti';
                        return;
                    }
                    var ogr = liste[sira];
                    var renk = 'b-orta';
                    if(ogr.durum.includes('iyi')) renk='b-iyi';
                    if(ogr.durum.includes('zayif')) renk='b-zayif';
                    
                    document.getElementById('info').innerHTML = 
                        'SÄ±radaki: <b>' + ogr.ad + '</b><br>' +
                        'Durum: <span class=\"badge '+renk+'\">' + ogr.durum.toUpperCase() + '</span>';
                    
                    document.getElementById('counter').innerText = (sira + 1);
                }

                function listeyiYukle(){
                    var raw = document.getElementById('data').value.trim();
                    if(!raw){ alert('LÃ¼tfen listeyi yapÄ±ÅŸtÄ±rÄ±n.'); return; }
                    
                    liste = [];
                    var lines = raw.split('\\n');
                    lines.forEach(function(line){
                        var parts = line.split('\\t');
                        if(parts.length<2) parts=line.split(' ');
                        if(parts.length>=2){
                            var durum = parts.pop().trim().toLowerCase();
                            var ad = parts.join(' ').trim();
                            if(ad.length>2) liste.push({ad:ad, durum:durum});
                        }
                    });

                    document.getElementById('total').innerText = liste.length;
                    document.getElementById('setupArea').style.display = 'none';
                    document.getElementById('runArea').style.display = 'block';
                    sira = 0;
                    guncelleInfo();
                }

                function atla(){
                    sira++;
                    guncelleInfo();
                }

                function siradakiIslem(){
                    if(sira >= liste.length) return;
                    var ogrenci = liste[sira];
                    var btn = document.getElementById('btnNext');
                    
                    btn.innerText = 'â³ Ä°ÅŸleniyor...';
                    btn.style.background = '#95a5a6';

                    try {
                        /* 1. Ã–ÄŸrenciyi Bul ve SeÃ§ */
                        var bulundu = false;
                        var allLinks = anaPencere.document.links;
                        
                        // Linklerde ara
                        for(var i=0; i<allLinks.length; i++){
                            if(allLinks[i].innerText.includes(ogrenci.ad)){
                                allLinks[i].click();
                                bulundu = true;
                                break;
                            }
                        }
                        
                        // Bulamazsa div/span/td iÃ§inde ara (Yedek)
                        if(!bulundu){
                             var allDivs = anaPencere.document.querySelectorAll('td, div, span');
                             for(var i=0; i<allDivs.length; i++){
                                if(allDivs[i].innerText.trim() == ogrenci.ad){
                                    allDivs[i].click();
                                    bulundu = true; 
                                    break;
                                }
                            }
                        }

                        if(!bulundu){
                            alert('âš ï¸ Ã–ÄŸrenci sayfada bulunamadÄ±: ' + ogrenci.ad + '\\nLÃ¼tfen doÄŸru sÄ±nÄ±fta olduÄŸunuzdan emin olun.');
                            btn.innerText = 'â–¶ï¸ Tekrar Dene';
                            btn.style.background = '#c0392b';
                            return;
                        }

                        /* 2. KÄ±sa bekleme ve Doldurma */
                        setTimeout(function(){
                            doldurVeKaydet(ogrenci.durum);
                        }, 2000); // 2 saniye bekle (Sayfa yÃ¼klenmesi iÃ§in)

                    } catch(e) {
                        alert('BaÄŸlantÄ± koptu. LÃ¼tfen e-Okul sayfasÄ±nÄ± yenileyip butona tekrar basÄ±n.');
                        btn.innerText = 'â–¶ï¸ UYGULA VE KAYDET';
                        btn.style.background = '#27ae60';
                    }
                }

                function doldurVeKaydet(durum){
                    try {
                        var tip = 'orta';
                        if(durum.includes('iyi') || durum.includes('pekiyi')) tip = 'iyi';
                        else if(durum.includes('zayÄ±f')) tip = 'zayÄ±f';

                        var gruplar = {};
                        var inputs = anaPencere.document.querySelectorAll('input[type=radio]');
                        
                        if(inputs.length === 0){
                             alert('Sayfada doldurulacak form bulunamadÄ±! Ã–ÄŸrenci seÃ§imi tam yÃ¼klenmemiÅŸ olabilir. Tekrar deneyin.');
                             document.getElementById('btnNext').innerText = 'â–¶ï¸ UYGULA VE KAYDET';
                             document.getElementById('btnNext').style.background = '#27ae60';
                             return;
                        }

                        inputs.forEach(function(r){
                            if(r.name){
                                if(!gruplar[r.name]) gruplar[r.name] = [];
                                gruplar[r.name].push(r);
                            }
                        });

                        for(var n in gruplar){
                            var val = '2';
                            var rnd = Math.random();
                            if(tip === 'iyi') val = rnd < 0.7 ? '4' : '3';
                            else if(tip === 'zayÄ±f') val = rnd < 0.6 ? '1' : '2';
                            else val = rnd < 0.2 ? '1' : (rnd < 0.8 ? '2' : '3');

                            gruplar[n].forEach(function(r){
                                if(r.value == val) r.click();
                            });
                        }

                        // KAYDETME Ä°ÅLEMÄ°
                        var btnKaydet = anaPencere.document.querySelector('.btn-success') || 
                                        anaPencere.document.querySelector('a[onclick*=\\'Kaydet\\']') ||
                                        anaPencere.document.querySelector('input[value=\\'Kaydet\\']');
                        
                        if(btnKaydet){
                            btnKaydet.click();
                            
                            // BaÅŸarÄ±lÄ± oldu, sÄ±rayÄ± artÄ±r
                            sira++;
                            guncelleInfo();
                            
                            // Butonu eski haline getir
                            document.getElementById('btnNext').innerText = 'â–¶ï¸ UYGULA VE KAYDET';
                            document.getElementById('btnNext').style.background = '#27ae60';
                            
                        } else {
                            alert('Kaydet butonu bulunamadÄ±!');
                        }

                    } catch(e){
                        alert('Hata: ' + e);
                    }
                }
            <\/script></html>
            `;
            kumanda.document.write(html);
        })();">
            ğŸ‘£ AdÄ±m AdÄ±m (SÃ¼rÃ¼kle)
        </a>

        <p style="font-size: 13px; color: #ccc; margin-top:20px;">
            <b>NasÄ±l Ã‡alÄ±ÅŸÄ±r?</b><br>
            1. <b>Mavi butonu</b> yer imlerine sÃ¼rÃ¼kleyin.<br>
            2. e-Okul'a girip butona basÄ±n (Pop-up izni verin).<br>
            3. Excel listenizi yapÄ±ÅŸtÄ±rÄ±n.<br>
            4. <b>"UYGULA VE KAYDET"</b> butonuna her bastÄ±ÄŸÄ±nÄ±zda sÄ±radaki Ã¶ÄŸrenciyi halleder.
        </p>
    </div>

</body>
</html>
