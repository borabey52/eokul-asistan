<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>e-Okul Tam Otomasyon</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #2c3e50; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: white; }
        .card { background: white; color:#333; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); max-width: 500px; text-align: center; }
        .bookmark-btn {
            display: inline-block;
            background: #e74c3c; /* KÄ±rmÄ±zÄ±: Kumanda Modu */
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 18px;
            border: 2px dashed #c0392b;
            cursor: grab;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
            transition: transform 0.2s;
        }
        .bookmark-btn:hover { transform: scale(1.05); }
    </style>
</head>
<body>

    <div class="card">
        <h1>ğŸ® e-Okul Kumanda Merkezi</h1>
        <p>Sayfa yenilense bile durmayan tam otomatik sistem.</p>

        <a class="bookmark-btn" href="javascript:(function(){
            /* 1. Kumanda Penceresini AÃ§ */
            var kumanda=window.open('','GeminiKumanda','width=350,height=600,top=50,left=50');
            if(!kumanda){alert('LÃ¼tfen tarayÄ±cÄ± adres Ã§ubuÄŸundan POP-UP izni verin!');return}

            /* 2. Pencere Ä°Ã§eriÄŸini OluÅŸtur */
            var html=`
            <html><head><style>
                body{font-family:sans-serif;padding:10px;background:#f4f4f4}
                textarea{width:100%;height:100px;font-size:11px}
                button{width:100%;padding:10px;margin:5px 0;cursor:pointer;font-weight:bold;color:white;border:none;border-radius:5px}
                .btn-start{background:#27ae60} .btn-stop{background:#c0392b}
                #log{font-size:11px;color:#555;height:150px;overflow-y:auto;background:white;padding:5px;border:1px solid #ccc}
                .status{padding:5px;background:#ddd;margin-bottom:5px;font-size:12px;text-align:center}
            </style></head><body>
                <h3>ğŸ¤– Otomatik Pilot</h3>
                <div class='status'>Ana pencereyi kapatmayÄ±n!</div>
                <textarea id='data' placeholder='Excelden YapÄ±ÅŸtÄ±r:\nAd Soyad   Durum\nAhmet      Ä°yi'></textarea>
                <button onclick='baslat()' class='btn-start'>â–¶ï¸ Otomatik BaÅŸlat</button>
                <button onclick='dur()' class='btn-stop'>â¹ï¸ Durdur</button>
                <div id='log'>HazÄ±r...</div>
            </body>
            <script>
                var liste = [];
                var sira = 0;
                var calisiyor = false;
                var anaPencere = window.opener;

                function log(msg){
                    var l = document.getElementById('log');
                    l.innerHTML = msg + '<br>' + l.innerHTML;
                }

                function dur(){ calisiyor = false; log('â›” Ä°ÅŸlem durduruldu.'); }

                function baslat(){
                    var raw = document.getElementById('data').value.trim();
                    if(!raw){ alert('Veri yok!'); return; }
                    
                    /* Listeyi Parse Et */
                    liste = [];
                    var lines = raw.split('\\n');
                    lines.forEach(function(line){
                        var parts = line.split('\\t');
                        if(parts.length<2) parts=line.split(' ');
                        if(parts.length>=2){
                            var durum = parts.pop().trim().toLowerCase();
                            var ad = parts.join(' ').trim();
                            liste.push({ad:ad, durum:durum});
                        }
                    });

                    log('âœ… ' + liste.length + ' Ã¶ÄŸrenci yÃ¼klendi.');
                    calisiyor = true;
                    sira = 0;
                    islemDongusu();
                }

                function islemDongusu(){
                    if(!calisiyor) return;
                    if(sira >= liste.length){ log('ğŸ‰ TÃœM LÄ°STE BÄ°TTÄ°!'); return; }

                    var ogrenci = liste[sira];
                    log('â³ Ä°ÅŸleniyor: ' + ogrenci.ad);

                    try {
                        /* 1. Ã–ÄŸrenciyi Bul ve TÄ±kla */
                        var linkler = anaPencere.document.querySelectorAll('a, tr td'); 
                        var bulundu = false;
                        
                        /* e-Okul yapÄ±sÄ±na gÃ¶re Ã¶ÄŸrenci ismini arÄ±yoruz */
                        /* Genelde sol menÃ¼de veya tabloda olur */
                        /* Not: Tam yapÄ±yÄ± bilmediÄŸimiz iÃ§in genel metin taramasÄ± yapÄ±yoruz */
                        /* DoÄŸrudan tÄ±klanabilir bir Ã¶ÄŸe arÄ±yoruz */
                        
                        // Basit bir findText simÃ¼lasyonu
                        // Sol frame veya ana iÃ§erikteki linkleri tara
                        
                        /* EÄER SOL FRAME VARSA ORAYA BAKMALIYIZ, YOKSA BODY */
                        /* KullanÄ±cÄ± sol listeden Ã¶ÄŸrenci seÃ§tiÄŸi iÃ§in oradaki linklere bakacaÄŸÄ±z */
                        
                        /* Bu kÄ±sÄ±m biraz deneme yanÄ±lma, MEB yapÄ±sÄ±nda genelde Ã¶ÄŸrenci ismi bir <a> etiketidir veya tablo satÄ±rÄ±dÄ±r */
                        /* Biz window.find kullanalÄ±m */
                        
                        anaPencere.getSelection().removeAllRanges();
                        if(anaPencere.find(ogrenci.ad)){
                           // Bulunan elementi alÄ±p tÄ±klamamÄ±z lazÄ±m, find() sadece seÃ§er.
                           // Bu yÃ¼zden DOM taramasÄ± daha garantidir.
                           // Liste sol tarafta "solFrame" vs olabilir mi? Genelde tek sayfadÄ±r.
                        }
                        
                        /* GÃ¼venli YÃ¶ntem: TÃ¼m linklerde isme bak */
                        var allLinks = anaPencere.document.links;
                        for(var i=0; i<allLinks.length; i++){
                            if(allLinks[i].innerText.includes(ogrenci.ad)){
                                allLinks[i].click();
                                bulundu = true;
                                break;
                            }
                        }
                        
                        if(!bulundu){
                            // Belki bir div veya span iÃ§indedir
                             var allDivs = anaPencere.document.querySelectorAll('td, div, span');
                             for(var i=0; i<allDivs.length; i++){
                                if(allDivs[i].innerText.trim() == ogrenci.ad){
                                    allDivs[i].click(); // TÄ±klamayÄ± dene
                                    bulundu = true; 
                                    break;
                                }
                            }
                        }

                        if(!bulundu){
                            log('âŒ BulunamadÄ±: ' + ogrenci.ad + ' (AtlanÄ±yor)');
                            sira++;
                            setTimeout(islemDongusu, 1000);
                            return;
                        }

                        /* 2. SayfanÄ±n yÃ¼klenmesini bekle ve Doldur */
                        log('...Sayfa yÃ¼kleniyor (3sn)...');
                        
                        setTimeout(function(){
                            // Form Doldurma Fonksiyonu
                            doldurVeKaydet(ogrenci.durum);
                        }, 3000); // 3 saniye bekle (Sayfa hÄ±zÄ± yavaÅŸsa burayÄ± artÄ±rÄ±n)

                    } catch(e) {
                        log('Hata: ' + e.message);
                        // Ana sayfa yenilendiyse referans kaybÄ± olabilir, tekrar dene
                        setTimeout(islemDongusu, 2000);
                    }
                }

                function doldurVeKaydet(durum){
                    try {
                        var tip = 'orta';
                        if(durum.includes('iyi') || durum.includes('pekiyi')) tip = 'iyi';
                        else if(durum.includes('zayÄ±f')) tip = 'zayÄ±f';

                        // Radyo butonlarÄ±nÄ± bul
                        var gruplar = {};
                        var inputs = anaPencere.document.querySelectorAll('input[type=radio]');
                        inputs.forEach(function(r){
                            if(r.name){
                                if(!gruplar[r.name]) gruplar[r.name] = [];
                                gruplar[r.name].push(r);
                            }
                        });

                        // Ä°ÅŸaretle
                        for(var n in gruplar){
                            var val = '2';
                            var rnd = Math.random();
                            if(tip === 'iyi') val = rnd < 0.7 ? '4' : '3';
                            else if(tip === 'zayÄ±f') val = rnd < 0.6 ? '1' : '2';
                            else val = rnd < 0.2 ? '1' : (rnd < 0.8 ? '2' : '3');

                            gruplar[n].forEach(function(r){
                                if(r.value == val) r.click();
                            });
                        }

                        // Kaydet Butonuna Bas
                        var btnKaydet = anaPencere.document.querySelector('.btn-success') || 
                                        anaPencere.document.querySelector('a[onclick*=\\'Kaydet\\']') ||
                                        anaPencere.document.querySelector('input[value=\\'Kaydet\\']');
                        
                        if(btnKaydet){
                            log('ğŸ’¾ Kaydediliyor...');
                            btnKaydet.click();
                            
                            // KayÄ±ttan sonra bekle ve sonraki Ã¶ÄŸrenciye geÃ§
                            sira++;
                            setTimeout(islemDongusu, 4000); // Kaydetme ve yenileme sÃ¼resi (4sn)
                        } else {
                            log('âš ï¸ Kaydet butonu bulunamadÄ±!');
                            sira++;
                            setTimeout(islemDongusu, 1000);
                        }

                    } catch(e){
                        log('Doldurma HatasÄ±: ' + e);
                        setTimeout(islemDongusu, 2000);
                    }
                }
            <\/script></html>
            `;
            kumanda.document.write(html);
        })();">
            ğŸ® Kumanda AsistanÄ± (SÃ¼rÃ¼kle)
        </a>

        <p style="font-size: 13px; color: #ccc; margin-top:20px;">
            <b>NasÄ±l Ã‡alÄ±ÅŸÄ±r?</b><br>
            1. Butonu yer imlerine sÃ¼rÃ¼kleyin.<br>
            2. e-Okul'a girip tÄ±klayÄ±n. <b>AÃ§Ä±lÄ±r Pencereye (Pop-up) izin verin.</b><br>
            3. AÃ§Ä±lan kÃ¼Ã§Ã¼k pencereye listeyi yapÄ±ÅŸtÄ±rÄ±p "BaÅŸlat" deyin.<br>
            4. ArkanÄ±za yaslanÄ±n, o sizin yerinize tÄ±klayÄ±p kaydedecek.
        </p>
    </div>

</body>
</html>
